{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormControl, FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport { map, switchMap, take, tap } from 'rxjs/operators';\nimport { UserAlbumsStateModule } from '../../../../application/state/user-albums.state-module';\nimport { UsersServiceModule } from '../../../secondary/services/users/users.service-module';\nimport { PhotosServiceModule } from '../../../secondary/services/photos/photos.service-module';\nimport { GET_USER_DETAILS_QUERY_PORT } from '../../../../application/ports/primary/query/get-user-details.query-port';\nimport { UPDATE_SPECIFIC_PROPERTY_COMMAND_PORT } from '../../../../application/ports/primary/command/update-specific-property.command-port';\nimport { SpecificPropertyCommand } from '../../../../application/ports/primary/command/specific-property.command';\nimport { BehaviorSubject, Subject, takeUntil } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-bootstrap/modal\";\nimport * as i2 from \"@angular/forms\";\nexport class EditUserDetailsModalComponent {\n  constructor(bsModalRef, _getUserDetailsQueryPort, _updateSpecificPropertyCommandPort) {\n    this.bsModalRef = bsModalRef;\n    this._getUserDetailsQueryPort = _getUserDetailsQueryPort;\n    this._updateSpecificPropertyCommandPort = _updateSpecificPropertyCommandPort;\n    this.editValueForm = new FormGroup({\n      value: new FormControl()\n    });\n    this._onDestroy$ = new Subject();\n    this._valueSubject = new BehaviorSubject('');\n  }\n  ngOnInit() {\n    this.prepopulateForm();\n    this.saveNewValueInSubject();\n  }\n  ngOnDestroy() {\n    this._onDestroy$.next();\n    this._onDestroy$.complete();\n  }\n  update() {\n    this._valueSubject.asObservable().pipe(take(1), switchMap(data => this._updateSpecificPropertyCommandPort.updateSpecificProperty(new SpecificPropertyCommand(this.propertyName, data)))).subscribe();\n  }\n  prepopulateForm() {\n    this._getUserDetailsQueryPort.getUserDetails().pipe(take(1), map(user => user[this.propertyName]), tap(data => this.editValueForm.patchValue({\n      value: data\n    }))).subscribe();\n  }\n  saveNewValueInSubject() {\n    this.editValueForm.get('value')?.valueChanges.pipe(tap(value => this._valueSubject.next(value)), takeUntil(this._onDestroy$)).subscribe();\n  }\n  static #_ = this.ɵfac = function EditUserDetailsModalComponent_Factory(t) {\n    return new (t || EditUserDetailsModalComponent)(i0.ɵɵdirectiveInject(i1.BsModalRef), i0.ɵɵdirectiveInject(GET_USER_DETAILS_QUERY_PORT), i0.ɵɵdirectiveInject(UPDATE_SPECIFIC_PROPERTY_COMMAND_PORT));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditUserDetailsModalComponent,\n    selectors: [[\"lib-edit-user-details-modal\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 11,\n    vars: 4,\n    consts: [[1, \"modal-header\"], [1, \"modal-title\", \"pull-left\"], [\"type\", \"button\", 1, \"btn-close\", \"close\", \"pull-right\", 3, \"click\"], [3, \"formGroup\"], [\"type\", \"text\", \"formControlName\", \"value\", 1, \"form-control\"], [1, \"d-flex\", \"justify-content-between\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function EditUserDetailsModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h4\", 1);\n        i0.ɵɵtext(2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"button\", 2);\n        i0.ɵɵlistener(\"click\", function EditUserDetailsModalComponent_Template_button_click_3_listener() {\n          return ctx.bsModalRef.hide();\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(4, \"form\", 3);\n        i0.ɵɵelement(5, \"input\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 5)(7, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function EditUserDetailsModalComponent_Template_button_click_7_listener() {\n          return ctx.update();\n        });\n        i0.ɵɵtext(8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function EditUserDetailsModalComponent_Template_button_click_9_listener() {\n          return ctx.bsModalRef.hide();\n        });\n        i0.ɵɵtext(10);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.title);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"formGroup\", ctx.editValueForm);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", ctx.saveBtnName, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\" \", ctx.closeBtnName, \" \");\n      }\n    },\n    dependencies: [CommonModule, UserAlbumsStateModule, UsersServiceModule, PhotosServiceModule, ReactiveFormsModule, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n}","map":{"version":3,"mappings":"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","names":["CommonModule","FormControl","FormGroup","ReactiveFormsModule","map","switchMap","take","tap","UserAlbumsStateModule","UsersServiceModule","PhotosServiceModule","GET_USER_DETAILS_QUERY_PORT","UPDATE_SPECIFIC_PROPERTY_COMMAND_PORT","SpecificPropertyCommand","BehaviorSubject","Subject","takeUntil","EditUserDetailsModalComponent","constructor","bsModalRef","_getUserDetailsQueryPort","_updateSpecificPropertyCommandPort","value","ngOnInit","prepopulateForm","saveNewValueInSubject","ngOnDestroy","_onDestroy$","next","complete","update","_valueSubject","asObservable","pipe","data","updateSpecificProperty","propertyName","subscribe","getUserDetails","user","editValueForm","patchValue","get","valueChanges","selectors","standalone","features","decls","vars","consts","template","i0","ctx","encapsulation","changeDetection"],"sourceRoot":"","sources":["E:\\WORK\\task\\projects\\user-albums\\src\\lib\\adapters\\primary\\components\\edit-user-details-modal\\edit-user-details-modal.component.ts","E:\\WORK\\task\\projects\\user-albums\\src\\lib\\adapters\\primary\\components\\edit-user-details-modal\\edit-user-details-modal.component.html"],"sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  OnDestroy,\n  OnInit,\n} from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormControl, FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport { map, switchMap, take, tap } from 'rxjs/operators';\nimport { UserAlbumsStateModule } from '../../../../application/state/user-albums.state-module';\nimport { UsersServiceModule } from '../../../secondary/services/users/users.service-module';\nimport { PhotosServiceModule } from '../../../secondary/services/photos/photos.service-module';\nimport { UserQuery } from '../../../../application/ports/primary/query/user.query';\nimport {\n  GET_USER_DETAILS_QUERY_PORT,\n  GetUserDetailsQueryPort,\n} from '../../../../application/ports/primary/query/get-user-details.query-port';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport {\n  UPDATE_SPECIFIC_PROPERTY_COMMAND_PORT,\n  UpdateSpecificPropertyCommandPort,\n} from '../../../../application/ports/primary/command/update-specific-property.command-port';\nimport { SpecificPropertyCommand } from '../../../../application/ports/primary/command/specific-property.command';\nimport { BehaviorSubject, Subject, takeUntil } from 'rxjs';\n\n@Component({\n  selector: 'lib-edit-user-details-modal',\n  templateUrl: './edit-user-details-modal.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    CommonModule,\n    UserAlbumsStateModule,\n    UsersServiceModule,\n    PhotosServiceModule,\n    ReactiveFormsModule,\n  ],\n})\nexport class EditUserDetailsModalComponent implements OnInit, OnDestroy {\n  title?: string;\n  closeBtnName?: string;\n  saveBtnName?: string;\n  propertyName?: string | number;\n\n  readonly editValueForm: FormGroup = new FormGroup({\n    value: new FormControl(),\n  });\n\n  private readonly _onDestroy$ = new Subject<void>();\n  private _valueSubject: BehaviorSubject<string | number> = new BehaviorSubject<\n    string | number\n  >('');\n\n  constructor(\n    public bsModalRef: BsModalRef,\n    @Inject(GET_USER_DETAILS_QUERY_PORT)\n    private _getUserDetailsQueryPort: GetUserDetailsQueryPort,\n    @Inject(UPDATE_SPECIFIC_PROPERTY_COMMAND_PORT)\n    private _updateSpecificPropertyCommandPort: UpdateSpecificPropertyCommandPort\n  ) {}\n\n  ngOnInit(): void {\n    this.prepopulateForm();\n    this.saveNewValueInSubject();\n  }\n\n  ngOnDestroy(): void {\n    this._onDestroy$.next();\n    this._onDestroy$.complete();\n  }\n\n  update(): void {\n    this._valueSubject\n      .asObservable()\n      .pipe(\n        take(1),\n        switchMap((data: string | number) =>\n          this._updateSpecificPropertyCommandPort.updateSpecificProperty(\n            new SpecificPropertyCommand(\n              this.propertyName as keyof UserQuery,\n              data\n            )\n          )\n        )\n      )\n      .subscribe();\n  }\n\n  private prepopulateForm(): void {\n    this._getUserDetailsQueryPort\n      .getUserDetails()\n      .pipe(\n        take(1),\n        map((user: UserQuery) => user[this.propertyName as keyof UserQuery]),\n        tap((data: string | number) =>\n          this.editValueForm.patchValue({ value: data })\n        )\n      )\n      .subscribe();\n  }\n\n  private saveNewValueInSubject(): void {\n    this.editValueForm\n      .get('value')\n      ?.valueChanges.pipe(\n        tap((value: string | number) => this._valueSubject.next(value)),\n        takeUntil(this._onDestroy$)\n      )\n      .subscribe();\n  }\n}\n","<div class=\"modal-header\">\n  <h4 class=\"modal-title pull-left\">{{ title }}</h4>\n  <button\n    type=\"button\"\n    class=\"btn-close close pull-right\"\n    (click)=\"bsModalRef.hide()\"\n  ></button>\n</div>\n<form [formGroup]=\"editValueForm\">\n  <input type=\"text\" formControlName=\"value\" class=\"form-control\"/>\n</form>\n<div class=\"d-flex justify-content-between\">\n  <button type=\"submit\" class=\"btn btn-primary\" (click)=\"update()\">\n    {{ saveBtnName }}\n  </button>\n  <button class=\"btn btn-primary\" (click)=\"bsModalRef.hide()\">\n    {{ closeBtnName }}\n  </button>\n</div>\n<!--<div class=\"modal-footer\">-->\n<!--  <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">-->\n<!--    {{ closeBtnName }}-->\n<!--  </button>-->\n<!--</div>-->\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}