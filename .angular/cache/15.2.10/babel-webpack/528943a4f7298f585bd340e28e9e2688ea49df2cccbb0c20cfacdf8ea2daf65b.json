{"ast":null,"code":"import { BehaviorSubject, combineLatestWith, shareReplay, Subject, takeUntil } from 'rxjs';\nimport { GET_ALL_PHOTOS_QUERY_PORT } from '../../../../application/ports/primary/query/get-all-photos.query-port';\nimport { CommonModule } from '@angular/common';\nimport { map } from 'rxjs/operators';\nimport { NavbarComponent } from '@core';\nimport { FormControl, FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/router\";\nfunction AlbumComponent_ng_container_2_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0);\n  }\n}\nfunction AlbumComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AlbumComponent_ng_container_2_ng_container_1_Template, 1, 0, \"ng-container\", 9);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r2 = i0.ɵɵreference(19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r2);\n  }\n}\nfunction AlbumComponent_ng_container_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 10)(2, \"div\", 11);\n    i0.ɵɵelement(3, \"img\", 12);\n    i0.ɵɵelementStart(4, \"div\", 13)(5, \"h5\", 14);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 15);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\", 16);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const photo_r5 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", photo_r5.thumbnailUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(photo_r5.title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"routerLink\", \"/users/\" + photo_r5.authorId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Author: \", photo_r5.author, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Price: \", photo_r5.price, \"\");\n  }\n}\nfunction AlbumComponent_ng_template_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 17);\n    i0.ɵɵtext(1, \"No results....\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class AlbumComponent {\n  constructor(_getAllPhotosQueryPort) {\n    this._getAllPhotosQueryPort = _getAllPhotosQueryPort;\n    this.filterByPriceForm = new FormGroup({\n      price: new FormControl()\n    });\n    this._searchSubject = new BehaviorSubject('');\n    this._priceFilterSubject = new BehaviorSubject(50);\n    this._onDestroy$ = new Subject();\n    this.priceFilter$ = this._priceFilterSubject.asObservable();\n    this.photos$ = this._getAllPhotosQueryPort.getAllPhotos().pipe(combineLatestWith(this._searchSubject.asObservable()), map(([photos, search]) => {\n      const regexp = new RegExp(search ?? '', 'i');\n      return photos.filter(photo => regexp.test(photo.title) || regexp.test(photo.author));\n    }), combineLatestWith(this.priceFilter$), map(([photos, price]) => photos.filter(photo => photo.price < price)), shareReplay({\n      bufferSize: 1,\n      refCount: true\n    }));\n  }\n  ngOnInit() {\n    this.filterByPriceForm.get('price')?.valueChanges.pipe(map(price => this._priceFilterSubject.next(price)), takeUntil(this._onDestroy$)).subscribe();\n  }\n  searchValue(event) {\n    this._searchSubject.next(event);\n  }\n  ngOnDestroy() {\n    this._onDestroy$.next();\n    this._onDestroy$.complete();\n  }\n  static #_ = this.ɵfac = function AlbumComponent_Factory(t) {\n    return new (t || AlbumComponent)(i0.ɵɵdirectiveInject(GET_ALL_PHOTOS_QUERY_PORT));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AlbumComponent,\n    selectors: [[\"lib-album\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 20,\n    vars: 20,\n    consts: [[3, \"showSearch\", \"summaryTitle\", \"count\", \"searchValueEvent\"], [4, \"ngIf\"], [1, \"container\", \"mt-5\", \"w-25\", \"justify-content-center\"], [3, \"formGroup\"], [\"type\", \"range\", \"min\", \"0\", \"max\", \"100\", \"step\", \"5\", \"value\", \"50\", \"formControlName\", \"price\", \"placeholder\", \"Price\", 1, \"form-range\"], [1, \"container\", \"mt-5\"], [1, \"row\"], [4, \"ngFor\", \"ngForOf\"], [\"noResults\", \"\"], [4, \"ngTemplateOutlet\"], [1, \"col-md-4\", \"mb-4\"], [1, \"card\"], [1, \"card-img-top\", 3, \"src\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"card-text\", 3, \"routerLink\"], [1, \"card-text\"], [1, \"text-info\", \"mt-5\", \"w-100\", \"text-center\"]],\n    template: function AlbumComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"lib-navbar\", 0);\n        i0.ɵɵlistener(\"searchValueEvent\", function AlbumComponent_Template_lib_navbar_searchValueEvent_0_listener($event) {\n          return ctx.searchValue($event);\n        });\n        i0.ɵɵpipe(1, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(2, AlbumComponent_ng_container_2_Template, 2, 1, \"ng-container\", 1);\n        i0.ɵɵpipe(3, \"async\");\n        i0.ɵɵelementStart(4, \"div\", 2)(5, \"form\", 3);\n        i0.ɵɵelement(6, \"input\", 4);\n        i0.ɵɵelementStart(7, \"p\");\n        i0.ɵɵtext(8);\n        i0.ɵɵpipe(9, \"currency\");\n        i0.ɵɵpipe(10, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"p\");\n        i0.ɵɵtext(12);\n        i0.ɵɵpipe(13, \"async\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(14, \"div\", 5)(15, \"div\", 6);\n        i0.ɵɵtemplate(16, AlbumComponent_ng_container_16_Template, 11, 5, \"ng-container\", 7);\n        i0.ɵɵpipe(17, \"async\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(18, AlbumComponent_ng_template_18_Template, 2, 0, \"ng-template\", null, 8, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        let tmp_2_0;\n        let tmp_3_0;\n        let tmp_6_0;\n        i0.ɵɵproperty(\"showSearch\", true)(\"summaryTitle\", \"Available items\")(\"count\", (tmp_2_0 = (tmp_2_0 = i0.ɵɵpipeBind1(1, 8, ctx.photos$)) == null ? null : tmp_2_0.length) !== null && tmp_2_0 !== undefined ? tmp_2_0 : 0);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !((tmp_3_0 = i0.ɵɵpipeBind1(3, 10, ctx.photos$)) == null ? null : tmp_3_0.length));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.filterByPriceForm);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"Max price: \", i0.ɵɵpipeBind1(9, 12, i0.ɵɵpipeBind1(10, 14, ctx.priceFilter$)), \"\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\"Items: \", (tmp_6_0 = i0.ɵɵpipeBind1(13, 16, ctx.photos$)) == null ? null : tmp_6_0.length, \"\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(17, 18, ctx.photos$));\n      }\n    },\n    dependencies: [CommonModule, i1.NgForOf, i1.NgIf, i1.NgTemplateOutlet, i1.AsyncPipe, i1.CurrencyPipe, NavbarComponent, ReactiveFormsModule, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.RangeValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, RouterModule, i3.RouterLink],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n}","map":{"version":3,"mappings":"AAOA,SACEA,eAAe,EACfC,iBAAiB,EAEjBC,WAAW,EACXC,OAAO,EACPC,SAAS,QACJ,MAAM;AAEb,SACEC,yBAAyB,QAEpB,uEAAuE;AAC9E,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,GAAG,QAAQ,gBAAgB;AACpC,SAASC,eAAe,QAAQ,OAAO;AACvC,SAASC,WAAW,EAAEC,SAAS,EAAEC,mBAAmB,QAAQ,gBAAgB;AAC5E,SAASC,YAAY,QAAQ,iBAAiB;;;;;;;ICf5CC,wBAA2D;;;;;IAD7DA,6BAAiD;IAC/CA,gGAA2D;IAC7DA,0BAAe;;;;;IADEA,eAA2B;IAA3BA,sCAA2B;;;;;IAcxCA,6BAAoD;IAClDA,+BAA2B;IAEvBA,0BAAsD;IACtDA,+BAAuB;IACEA,YAAiB;IAAAA,iBAAK;IAC7CA,6BAA+D;IAAAA,YAA0B;IAAAA,iBAAI;IAC7FA,6BAAqB;IAAAA,aAAwB;IAAAA,iBAAI;IAIzDA,0BAAe;;;;IARJA,eAA0B;IAA1BA,6DAA0B;IAENA,eAAiB;IAAjBA,oCAAiB;IACnBA,eAAyC;IAAzCA,0DAAyC;IAACA,eAA0B;IAA1BA,sDAA0B;IACpEA,eAAwB;IAAxBA,oDAAwB;;;;;IAUvDA,8BAA6C;IAAAA,8BAAc;IAAAA,iBAAK;;;ADPlE,OAAM,MAAOC,cAAc;EAiCzBC,YAEUC,sBAA6C;IAA7C,2BAAsB,GAAtBA,sBAAsB;IAlCvB,sBAAiB,GAAc,IAAIN,SAAS,CAAC;MACpDO,KAAK,EAAE,IAAIR,WAAW;KACvB,CAAC;IAEM,mBAAc,GAA4B,IAAIT,eAAe,CACnE,EAAE,CACH;IACO,wBAAmB,GACzB,IAAIA,eAAe,CAAS,EAAE,CAAC;IAChB,gBAAW,GAAG,IAAIG,OAAO,EAAQ;IAEzC,iBAAY,GACnB,IAAI,CAACe,mBAAmB,CAACC,YAAY,EAAE;IAEhC,YAAO,GAA6B,IAAI,CAACH,sBAAsB,CACrEI,YAAY,EAAE,CACdC,IAAI,CACHpB,iBAAiB,CAAC,IAAI,CAACqB,cAAc,CAACH,YAAY,EAAE,CAAC,EACrDZ,GAAG,CAAC,CAAC,CAACgB,MAAM,EAAEC,MAAM,CAAyB,KAAI;MAC/C,MAAMC,MAAM,GAAW,IAAIC,MAAM,CAACF,MAAM,IAAI,EAAE,EAAE,GAAG,CAAC;MACpD,OAAOD,MAAM,CAACI,MAAM,CACjBC,KAAiB,IAChBH,MAAM,CAACI,IAAI,CAACD,KAAK,CAACE,KAAK,CAAC,IAAIL,MAAM,CAACI,IAAI,CAACD,KAAK,CAACG,MAAM,CAAC,CACxD;IACH,CAAC,CAAC,EACF9B,iBAAiB,CAAC,IAAI,CAAC+B,YAAY,CAAC,EACpCzB,GAAG,CAAC,CAAC,CAACgB,MAAM,EAAEN,KAAK,CAAyB,KAC1CM,MAAM,CAACI,MAAM,CAAEC,KAAiB,IAAKA,KAAK,CAACX,KAAK,GAAGA,KAAK,CAAC,CAC1D,EACDf,WAAW,CAAC;MAAE+B,UAAU,EAAE,CAAC;MAAEC,QAAQ,EAAE;IAAI,CAAE,CAAC,CAC/C;EAKA;EAEHC,QAAQ;IACN,IAAI,CAACC,iBAAiB,CACnBC,GAAG,CAAC,OAAO,CAAC,EACXC,YAAY,CAACjB,IAAI,CACjBd,GAAG,CAAEU,KAAa,IAAK,IAAI,CAACC,mBAAmB,CAACqB,IAAI,CAACtB,KAAK,CAAC,CAAC,EAC5Db,SAAS,CAAC,IAAI,CAACoC,WAAW,CAAC,CAC5B,CACAC,SAAS,EAAE;EAChB;EAEAC,WAAW,CAACC,KAAa;IACvB,IAAI,CAACrB,cAAc,CAACiB,IAAI,CAACI,KAAK,CAAC;EACjC;EAEAC,WAAW;IACT,IAAI,CAACJ,WAAW,CAACD,IAAI,EAAE;IACvB,IAAI,CAACC,WAAW,CAACK,QAAQ,EAAE;EAC7B;EAAC;qBAvDU/B,cAAc,uBAkCfT,yBAAyB;EAAA;EAAA;UAlCxBS,cAAc;IAAAgC;IAAAC;IAAAC;IAAAC;IAAAC;IAAAC;IAAAC;MAAA;QCjC3BvC,qCAKC;QAHCA;UAAA,OAAoBwC,uBAAmB;QAAA,EAAC;;QAGzCxC,iBAAa;QAGdA,iFAEe;;QAEfA,8BAAwD;QAEpDA,2BAC4B;QAC5BA,yBAAG;QAAAA,YAA8C;;;QAAAA,iBAAI;QACrDA,0BAAG;QAAAA,aAAoC;;QAAAA,iBAAI;QAI/CA,+BAA4B;QAExBA,oFAWe;;QACjBA,iBAAM;QAIRA,kHAEc;;;;;;QAxCZA,iCAAmB;QAONA,eAAgC;QAAhCA,wGAAgC;QAKvCA,eAA+B;QAA/BA,iDAA+B;QAGhCA,eAA8C;QAA9CA,yGAA8C;QAC9CA,eAAoC;QAApCA,qHAAoC;QAMPA,eAAkB;QAAlBA,6DAAkB;;;mBDQ1CP,YAAY,2EAAEE,eAAe,EAAEG,mBAAmB,4JAAEC,YAAY;IAAA0C;IAAAC;EAAA","names":["BehaviorSubject","combineLatestWith","shareReplay","Subject","takeUntil","GET_ALL_PHOTOS_QUERY_PORT","CommonModule","map","NavbarComponent","FormControl","FormGroup","ReactiveFormsModule","RouterModule","i0","AlbumComponent","constructor","_getAllPhotosQueryPort","price","_priceFilterSubject","asObservable","getAllPhotos","pipe","_searchSubject","photos","search","regexp","RegExp","filter","photo","test","title","author","priceFilter$","bufferSize","refCount","ngOnInit","filterByPriceForm","get","valueChanges","next","_onDestroy$","subscribe","searchValue","event","ngOnDestroy","complete","selectors","standalone","features","decls","vars","consts","template","ctx","encapsulation","changeDetection"],"sourceRoot":"","sources":["E:\\WORK\\task\\projects\\user-albums\\src\\lib\\adapters\\primary\\components\\album\\album.component.ts","E:\\WORK\\task\\projects\\user-albums\\src\\lib\\adapters\\primary\\components\\album\\album.component.html"],"sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  OnDestroy,\n  OnInit,\n} from '@angular/core';\nimport {\n  BehaviorSubject,\n  combineLatestWith,\n  Observable,\n  shareReplay,\n  Subject,\n  takeUntil,\n} from 'rxjs';\nimport { PhotoQuery } from '../../../../application/ports/primary/query/photo.query';\nimport {\n  GET_ALL_PHOTOS_QUERY_PORT,\n  GetAllPhotosQueryPort,\n} from '../../../../application/ports/primary/query/get-all-photos.query-port';\nimport { CommonModule } from '@angular/common';\nimport { map } from 'rxjs/operators';\nimport { NavbarComponent } from '@core';\nimport { FormControl, FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\n\n@Component({\n  selector: 'lib-album',\n  templateUrl: './album.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [CommonModule, NavbarComponent, ReactiveFormsModule, RouterModule],\n})\nexport class AlbumComponent implements OnInit, OnDestroy {\n  readonly filterByPriceForm: FormGroup = new FormGroup({\n    price: new FormControl(),\n  });\n\n  private _searchSubject: BehaviorSubject<string> = new BehaviorSubject<string>(\n    ''\n  );\n  private _priceFilterSubject: BehaviorSubject<number> =\n    new BehaviorSubject<number>(50);\n  private readonly _onDestroy$ = new Subject<void>();\n\n  readonly priceFilter$: Observable<number> =\n    this._priceFilterSubject.asObservable();\n\n  readonly photos$: Observable<PhotoQuery[]> = this._getAllPhotosQueryPort\n    .getAllPhotos()\n    .pipe(\n      combineLatestWith(this._searchSubject.asObservable()),\n      map(([photos, search]: [PhotoQuery[], string]) => {\n        const regexp: RegExp = new RegExp(search ?? '', 'i');\n        return photos.filter(\n          (photo: PhotoQuery) =>\n            regexp.test(photo.title) || regexp.test(photo.author)\n        );\n      }),\n      combineLatestWith(this.priceFilter$),\n      map(([photos, price]: [PhotoQuery[], number]) =>\n        photos.filter((photo: PhotoQuery) => photo.price < price)\n      ),\n      shareReplay({ bufferSize: 1, refCount: true })\n    );\n\n  constructor(\n    @Inject(GET_ALL_PHOTOS_QUERY_PORT)\n    private _getAllPhotosQueryPort: GetAllPhotosQueryPort\n  ) {}\n\n  ngOnInit(): void {\n    this.filterByPriceForm\n      .get('price')\n      ?.valueChanges.pipe(\n        map((price: number) => this._priceFilterSubject.next(price)),\n        takeUntil(this._onDestroy$)\n      )\n      .subscribe();\n  }\n\n  searchValue(event: string): void {\n    this._searchSubject.next(event);\n  }\n\n  ngOnDestroy(): void {\n    this._onDestroy$.next();\n    this._onDestroy$.complete();\n  }\n}\n","<lib-navbar\n  [showSearch]=\"true\"\n  (searchValueEvent)=\"searchValue($event)\"\n  [summaryTitle]=\"'Available items'\"\n  [count]=\"(photos$ | async)?.length ?? 0\"\n></lib-navbar>\n\n\n<ng-container *ngIf=\"!(photos$ | async)?.length\">\n  <ng-container *ngTemplateOutlet=\"noResults\"></ng-container>\n</ng-container>\n\n<div class=\"container mt-5 w-25 justify-content-center\">\n  <form [formGroup]=\"filterByPriceForm\">\n    <input type=\"range\" class=\"form-range\" min=\"0\" max=\"100\" step=\"5\" value=\"50\" formControlName=\"price\"\n           placeholder=\"Price\"/>\n    <p>Max price: {{priceFilter$ | async | currency}}</p>\n    <p>Items: {{(photos$ | async)?.length}}</p>\n  </form>\n</div>\n\n<div class=\"container mt-5\">\n  <div class=\"row\">\n    <ng-container *ngFor=\"let photo of photos$ | async\">\n      <div class=\"col-md-4 mb-4\">\n        <div class=\"card\">\n          <img [src]=\"photo.thumbnailUrl\" class=\"card-img-top\"/>\n          <div class=\"card-body\">\n            <h5 class=\"card-title\">{{ photo.title }}</h5>\n            <p class=\"card-text\" [routerLink]=\"'/users/' + photo.authorId\">Author: {{ photo.author }}</p>\n            <p class=\"card-text\">Price: {{ photo.price }}</p>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n</div>\n\n\n<ng-template #noResults>\n  <h1 class=\"text-info mt-5 w-100 text-center\">No results....</h1>\n</ng-template>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}